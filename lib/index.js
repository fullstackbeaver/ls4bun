// @bun
var Q;((V)=>{V.DELETE="DELETE";V.GET="GET";V.OPTIONS="OPTIONS";V.PATCH="PATCH";V.POST="POST";V.PUT="PUT"})(Q||={});import L from"isomorphic-dompurify";function $(E){return typeof E==="string"}function W(E){return L.sanitize(E)}function Y(E,G=200,U=new Headers){if(G>=300&&G<400)return Response.redirect(E,G);let N={headers:U,status:G};if(E===null)return new Response("",N);if($(E))return new Response(E,N);return Response.json(E,N)}import{sanitizeInput as A}from"utils/utils";var J={after:[],before:[]},Z;async function k(E,G,U=Y){let N=j(E);J.before&&await X(J.before,N);let T=await R(N,G);if(T.status)N.result.status=T.status;if(T.headers){let K=typeof T.headers.get==="function"?T.headers.entries():Object.entries(T.headers);for(let[V,C]of K)N.result.headers.set(V,C)}return N.result.body=T.body??T,J.after&&await X(J.after,N),U(N.result.body,N.result.status,N.result.headers)}function H({after:E,before:G}){if(G)J.before=G;if(E)J.after=E}async function R(E,{handler:G,inputSchema:U,outputSchema:N}){if(U&&!Z(U,E.body))throw new Error("400|wrong body data");let T=G.constructor.name==="AsyncFunction"?await G(E):G(E);if(N&&!Z(N,T))throw new Error("500|result is not as expected");return T}function j(E){return{body:z(E),context:{},headers:E.headers,method:E.method,params:E.params,query:E.url.includes("?")?new URLSearchParams(E.url.split("?")[1]):null,result:{body:null,headers:new Headers},url:E.url}}async function z(E){if(E.method==="GET"||E.method==="DELETE"||E.method==="OPTIONS"||!E.body)return null;if(!E.json)throw new Error("400|Invalid body");try{let G=await E.json();return A(G)}catch(G){throw new Error(`400|Invalid body
`+(G instanceof Error?G.message:G))}}function O(E){Z=E}async function X(E,G){for(let U of E)await U(G)}var{file:x}=globalThis.Bun;import _ from"fs";import S from"path";function B(E,G){return _.readdirSync(E).forEach((N)=>{let T=S.join(E,N);if(_.statSync(T).isDirectory())G=B(T,G);else G.push(T)}),G}function D(E){try{let G=B(E,[]),U=E.split("/").pop(),N=G[0].indexOf(U)+U.length;return{content:G.map((T)=>T.slice(N)),start:G[0].slice(0,N)}}catch(G){let U="500|";if(!(G instanceof Error))G=new Error(U+G);else G.message=U+G.message;throw G}}function P(E,G){function U(C){if(C.endsWith(N))C=C.replace(N,"");return G+C}if(G??=E,G.endsWith("/"))G=G.slice(0,-1);let N="index.html",{content:T,start:K}=D(E),V={};for(let C of T)V[U(C)]=I(K+C);return V}function I(E){return()=>new Response(x(E))}export{O as useValidator,H as useMiddlewares,I as staticFile,W as sanitizeString,Y as makeResponse,k as handleRoute,P as addStaticFolder,Q as Method};
