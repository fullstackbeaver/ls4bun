// @bun
var V;((J)=>{J.DELETE="DELETE";J.GET="GET";J.OPTIONS="OPTIONS";J.PATCH="PATCH";J.POST="POST";J.PUT="PUT"})(V||={});import{isString as A,sanitizeInput as R}from"utils/utils";import I from"isomorphic-dompurify";function Y(E){return typeof E==="string"}function W(E){return I.sanitize(E)}function Z(E,G=200,U={}){if(G>=300&&G<400)return Response.redirect(E,G);let N=new Headers;for(let[C,K]of Object.entries(U))N.set(C,Y(K)?K:`${K}`);if(E===null)return new Response("",{headers:N,status:G});if(Y(E))return new Response(E,{headers:N,status:G});return Response.json(E,{headers:N,status:G})}var T={after:[],before:[]},$;async function k(E,G,U=Z){let N=z(E);for(let C of T.before)await C(N);N.result=await j(N,G);for(let C of T.after)await C(N);return A(N.result)?U(N.result):U(N.result.body,N.result.status,N.result.headers)}function H(E){if(E.before)T.before=E.before;if(E.after)T.after=E.after}async function j(E,G){let{handler:U,inputSchema:N,outputSchema:C}=G;if(N&&!$(N,E.body))throw new Error("400|wrong body data");let K=U.constructor.name==="AsyncFunction"?await U(E):U(E);if(C&&!$(C,K))throw new Error("500|result is not as expected");return K}function z(E){return{body:O(E),context:{},headers:E.headers,method:E.method,params:E.params,query:E.url.includes("?")?new URLSearchParams(E.url.split("?")[1]):null,result:{body:null},url:E.url}}async function O(E){if(E.method==="GET"||E.method==="DELETE"||E.method==="OPTIONS"||!E.body)return null;if(E.headers.get("content-type")!=="application/json")throw new Error("400|Invalid content type. Expected application/json");try{return R(await JSON.parse(E.body.toString()))}catch(U){throw new Error(`400|Invalid body
`+(U instanceof Error?U.message:U))}}function L(E){$=E}var{file:x}=globalThis.Bun;import X from"fs";import S from"path";function _(E,G){return X.readdirSync(E).forEach((N)=>{let C=S.join(E,N);if(X.statSync(C).isDirectory())G=_(C,G);else G.push(C)}),G}function B(E){try{let G=_(E,[]),U=E.split("/").pop(),N=G[0].indexOf(U)+U.length;return{content:G.map((C)=>C.slice(N)),start:G[0].slice(0,N)}}catch(G){let U="500|";if(!(G instanceof Error))G=new Error(U+G);else G.message=U+G.message;throw G}}function M(E,G){function U(Q){if(Q.endsWith(N))Q=Q.replace(N,"");return G+Q}if(G??=E,G.endsWith("/"))G=G.slice(0,-1);let N="index.html",{content:C,start:K}=B(E),J={};for(let Q of C)J[U(Q)]=D(K+Q);return J}function D(E){return()=>new Response(x(E))}export{L as useValidator,H as useMiddlewares,D as staticFile,W as sanitizeString,Z as makeResponse,k as handleRoute,M as addStaticFolder,V as Method};
