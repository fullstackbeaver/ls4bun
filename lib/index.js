// @bun
var _;((V)=>{V.GET="GET";V.POST="POST";V.PUT="PUT";V.PATCH="PATCH";V.DELETE="DELETE"})(_||={});function J(E){return typeof E==="string"}function $(E){let D={'"':"&quot;","&":"&amp;","'":"&#39;","/":"&#x2F;","<":"&lt;",">":"&gt;"};return E.replace(/[&<>"'/]/g,(T)=>D[T]??T)}function K(E){if(J(E))return $(E);if(Array.isArray(E))return E.map(K);if(typeof E==="object"&&E!==null){let D={};for(let[T,G]of Object.entries(E))D[$(T)]=K(G);return D}return E}function Q(E,D=200,T={}){if(D>=300&&D<400)return Response.redirect(E,D);let G=new Headers;for(let[U,V]of Object.entries(T))G.set(U,J(V)?V:`${V}`);if(E===null)return new Response("",{headers:G,status:D});if(J(E))return new Response(E,{headers:G,status:D});return Response.json(E,{headers:G,status:D})}var N={after:[],before:[]},Y;async function A(E,D,T=Q){let G=M(E);for(let U of N.before)await U(G);G.result=await R(G,D);for(let U of N.after)await U(G);return J(G.result)?T(G.result):T(G.result.body,G.result.status,G.result.headers)}function I(E){if(E.before)N.before=E.before;if(E.after)N.after=E.after}async function R(E,D){let{handler:T,inputSchema:G,outputSchema:U}=D;if(G&&!Y(G,E.body))throw new Error("400|wrong body data");let V=T.constructor.name==="AsyncFunction"?await T(E):T(E);if(U&&!Y(U,V))throw new Error("500|result is not as expected");return V}function M(E){return{body:k(E),context:{},headers:E.headers,method:E.method,params:E.params,query:(E?.url).includes("?")?new URLSearchParams(E.url.split("?")[1]):null,result:{body:null},url:E.url}}async function k(E){if(E.method==="GET"||E.method==="DELETE"||E.method==="OPTIONS"||!E.body)return null;if(E.headers.get("content-type")!=="application/json")throw new Error("400|Invalid content type. Expected application/json");try{return K(await JSON.parse(E.body.toString()))}catch(T){throw new Error("400|Invalid body")}}function L(E){Y=E}var{file:j}=globalThis.Bun;import B from"fs";import O from"path";function H(E,D){return B.readdirSync(E).forEach((G)=>{let U=O.join(E,G);if(B.statSync(U).isDirectory())D=H(U,D);else D.push(U)}),D}function W(E){try{let D=H(E,[]),T=E.split("/").pop(),G=D[0].indexOf(T)+T.length;return{content:D.map((U)=>U.slice(G)),start:D[0].slice(0,G)}}catch(D){let T="500|";if(!(D instanceof Error))D=new Error(T+D);else D.message=T+D.message;throw D}}function z(E,D){function T(C){if(C.endsWith(G))C=C.replace(G,"");return D+C}if(D??=E,D.endsWith("/"))D=D.slice(0,-1);let G="index.html",{content:U,start:V}=W(E),Z={};for(let C of U)Z[T(C)]=X(V+C);return Z}function X(E){return()=>new Response(j(E))}export{L as useValidator,I as useMiddlewares,X as staticFile,Q as makeResponse,A as handleRoute,z as addStaticFolder,_ as Method};
