// @bun
var K;((V)=>{V.DELETE="DELETE";V.GET="GET";V.OPTIONS="OPTIONS";V.PATCH="PATCH";V.POST="POST";V.PUT="PUT"})(K||={});import I from"isomorphic-dompurify";function Z(E){return typeof E==="string"}function L(E){return I.sanitize(E)}function Q(E,G=200,T=new Headers){if(G>=300&&G<400)return Response.redirect(E,G);let N={headers:T,status:G};if(E===null)return new Response("",N);if(Z(E))return new Response(E,N);return Response.json(E,N)}import{sanitizeInput as W}from"utils/utils";var J={after:[],before:[]},Y;async function k(E,G,T=Q){let N=j(E);J.before&&await B(J.before,N);let U=await H(N,G);if(U.status)N.result.status=U.status;if(U.headers)N.result.headers={...N.result.headers,...U.headers};return N.result.body=U.body??U,J.after&&await B(J.after,N),T(N.result.body,N.result.status,N.result.headers)}function R({after:E,before:G}){if(G)J.before=G;if(E)J.after=E}async function H(E,{handler:G,inputSchema:T,outputSchema:N}){if(T&&!Y(T,E.body))throw new Error("400|wrong body data");let U=G.constructor.name==="AsyncFunction"?await G(E):G(E);if(N&&!Y(N,U))throw new Error("500|result is not as expected");return U}function j(E){return{body:z(E),context:{},headers:E.headers,method:E.method,params:E.params,query:E.url.includes("?")?new URLSearchParams(E.url.split("?")[1]):null,result:{body:null,headers:new Headers},url:E.url}}async function z(E){if(E.method==="GET"||E.method==="DELETE"||E.method==="OPTIONS"||!E.body)return null;if(E.headers.get("content-type")!=="application/json")throw new Error("400|Invalid content type. Expected application/json");try{return W(await JSON.parse(E.body.toString()))}catch(T){throw new Error(`400|Invalid body
`+(T instanceof Error?T.message:T))}}function O(E){Y=E}async function B(E,G){for(let T of E)await T(G)}var{file:x}=globalThis.Bun;import X from"fs";import S from"path";function _(E,G){return X.readdirSync(E).forEach((N)=>{let U=S.join(E,N);if(X.statSync(U).isDirectory())G=_(U,G);else G.push(U)}),G}function $(E){try{let G=_(E,[]),T=E.split("/").pop(),N=G[0].indexOf(T)+T.length;return{content:G.map((U)=>U.slice(N)),start:G[0].slice(0,N)}}catch(G){let T="500|";if(!(G instanceof Error))G=new Error(T+G);else G.message=T+G.message;throw G}}function w(E,G){function T(C){if(C.endsWith(N))C=C.replace(N,"");return G+C}if(G??=E,G.endsWith("/"))G=G.slice(0,-1);let N="index.html",{content:U,start:D}=$(E),V={};for(let C of U)V[T(C)]=A(D+C);return V}function A(E){return()=>new Response(x(E))}export{O as useValidator,R as useMiddlewares,A as staticFile,L as sanitizeString,Q as makeResponse,k as handleRoute,w as addStaticFolder,K as Method};
