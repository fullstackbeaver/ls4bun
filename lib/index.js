// @bun
var Z;((V)=>{V.DELETE="DELETE";V.GET="GET";V.OPTIONS="OPTIONS";V.PATCH="PATCH";V.POST="POST";V.PUT="PUT"})(Z||={});import K from"isomorphic-dompurify";function Q(E){return typeof E==="string"}function $(E){if(Q(E))return K.sanitize(E);if(Array.isArray(E))return E.map((G)=>Q(G)?K.sanitize(G):$(G));if(typeof E==="object"&&E!==null){let G={};for(let[T,N]of Object.entries(E))G[K.sanitize(T)]=$(N);return G}return E}function A(E){return K.sanitize(E)}function I(E,G=200,T=new Headers){if(G>=300&&G<400)return Response.redirect(E,G);let N={headers:T,status:G};if(E===null)return new Response("",N);if(Q(E))return new Response(E,N);return Response.json(E,N)}import{sanitizeInput as k}from"utils/utils";var J={after:[],before:[]},X;async function H(E,G,T=I){let N=j(E);J.before&&await _(J.before,N);let U=await z(N,G);if(U.status)N.result.status=U.status;if(U.headers){let Y=typeof U.headers.get==="function"?U.headers.entries():Object.entries(U.headers);for(let[V,C]of Y)N.result.headers.set(V,C)}return N.result.body=U.body??U,J.after&&await _(J.after,N),T(N.result.body,N.result.status,N.result.headers)}function R({after:E,before:G}){if(G)J.before=G;if(E)J.after=E}async function z(E,{handler:G,inputSchema:T,outputSchema:N}){if(T&&!X(T,E.body))throw new Error("400|wrong body data");let U=G.constructor.name==="AsyncFunction"?await G(E):G(E);if(N&&!X(N,U))throw new Error("500|result is not as expected");return U}function j(E){return{body:O(E),context:{},headers:E.headers,method:E.method,params:E.params,query:E.url.includes("?")?new URLSearchParams(E.url.split("?")[1]):null,result:{body:null,headers:new Headers},url:E.url}}async function O(E){if(E.method==="GET"||E.method==="DELETE"||E.method==="OPTIONS"||!E.body)return null;if(!E.json)throw new Error("400|Invalid body");try{let G=await E.json();return k(G)}catch(G){throw new Error(`400|Invalid body
`+(G instanceof Error?G.message:G))}}function S(E){X=E}async function _(E,G){for(let T of E)await T(G)}var{file:P}=globalThis.Bun;import B from"fs";import x from"path";function D(E,G){return B.readdirSync(E).forEach((N)=>{let U=x.join(E,N);if(B.statSync(U).isDirectory())G=D(U,G);else G.push(U)}),G}function L(E){try{let G=D(E,[]),T=E.split("/").pop(),N=G[0].indexOf(T)+T.length;return{content:G.map((U)=>U.slice(N)),start:G[0].slice(0,N)}}catch(G){let T="500|";if(!(G instanceof Error))G=new Error(T+G);else G.message=T+G.message;throw G}}function w(E,G){function T(C){if(C.endsWith(N))C=C.replace(N,"");return G+C}if(G??=E,G.endsWith("/"))G=G.slice(0,-1);let N="index.html",{content:U,start:Y}=L(E),V={};for(let C of U)V[T(C)]=W(Y+C);return V}function W(E){return()=>new Response(P(E))}export{S as useValidator,R as useMiddlewares,W as staticFile,A as sanitizeString,$ as sanitizeInput,I as makeResponse,H as handleRoute,w as addStaticFolder,Z as Method};
