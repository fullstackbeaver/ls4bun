// @bun
var Q;((V)=>{V.DELETE="DELETE";V.GET="GET";V.OPTIONS="OPTIONS";V.PATCH="PATCH";V.POST="POST";V.PUT="PUT"})(Q||={});import L from"isomorphic-dompurify";function $(E){return typeof E==="string"}function W(E){return L.sanitize(E)}function Y(E,G=200,T=new Headers){if(G>=300&&G<400)return Response.redirect(E,G);let N={headers:T,status:G};if(E===null)return new Response("",N);if($(E))return new Response(E,N);return Response.json(E,N)}import{sanitizeInput as A}from"utils/utils";var J={after:[],before:[]},Z;async function k(E,G,T=Y){let N=j(E);J.before&&await X(J.before,N);let U=await R(N,G);if(U.status)N.result.status=U.status;if(U.headers){let K=typeof U.headers.get==="function"?U.headers.entries():Object.entries(U.headers);for(let[V,C]of K)N.result.headers.set(V,C)}return N.result.body=U.body??U,J.after&&await X(J.after,N),T(N.result.body,N.result.status,N.result.headers)}function H({after:E,before:G}){if(G)J.before=G;if(E)J.after=E}async function R(E,{handler:G,inputSchema:T,outputSchema:N}){if(T&&!Z(T,E.body))throw new Error("400|wrong body data");let U=G.constructor.name==="AsyncFunction"?await G(E):G(E);if(N&&!Z(N,U))throw new Error("500|result is not as expected");return U}function j(E){return{body:z(E),context:{},headers:E.headers,method:E.method,params:E.params,query:E.url.includes("?")?new URLSearchParams(E.url.split("?")[1]):null,result:{body:null,headers:new Headers},url:E.url}}async function z(E){if(E.method==="GET"||E.method==="DELETE"||E.method==="OPTIONS"||!E.body)return null;if(E.headers.get("content-type")!=="application/json")throw new Error("400|Invalid content type. Expected application/json");try{return A(await JSON.parse(E.body.toString()))}catch(T){throw new Error(`400|Invalid body
`+(T instanceof Error?T.message:T))}}function O(E){Z=E}async function X(E,G){for(let T of E)await T(G)}var{file:x}=globalThis.Bun;import _ from"fs";import S from"path";function B(E,G){return _.readdirSync(E).forEach((N)=>{let U=S.join(E,N);if(_.statSync(U).isDirectory())G=B(U,G);else G.push(U)}),G}function D(E){try{let G=B(E,[]),T=E.split("/").pop(),N=G[0].indexOf(T)+T.length;return{content:G.map((U)=>U.slice(N)),start:G[0].slice(0,N)}}catch(G){let T="500|";if(!(G instanceof Error))G=new Error(T+G);else G.message=T+G.message;throw G}}function P(E,G){function T(C){if(C.endsWith(N))C=C.replace(N,"");return G+C}if(G??=E,G.endsWith("/"))G=G.slice(0,-1);let N="index.html",{content:U,start:K}=D(E),V={};for(let C of U)V[T(C)]=I(K+C);return V}function I(E){return()=>new Response(x(E))}export{O as useValidator,H as useMiddlewares,I as staticFile,W as sanitizeString,Y as makeResponse,k as handleRoute,P as addStaticFolder,Q as Method};
