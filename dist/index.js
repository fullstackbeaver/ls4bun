// @bun
var d;((x)=>{x.GET="GET";x.POST="POST";x.PUT="PUT";x.PATCH="PATCH";x.DELETE="DELETE"})(d||={});var A;(($)=>{$.CSS="text/css";$.HTML="text/html";$.JPG="image/jpeg";$.JS="application/javascript";$.JSON="application/json";$.SVG="image/svg+xml";$.TEXT="text/plain"})(A||={});var O={},l={},p=[],o={};async function LJ(J,G){if(G){for(let[X,Q]of Object.entries(G))O[X]=Q.action,Q.useOnFirstStart&&Q.action();Object.assign(l,J)}Object.assign(o,Bun.serve(J)),console.log("server started!")}async function P(J){console.log("Reloading server...",J);for(let G of J)if(O[G])O[G].constructor.name==="AsyncFunction"?await O[G]():O[G]();o.reload(l),console.log("Server reloaded")}async function bJ(J,G){let X={headers:J.headers,method:J.method,url:J.url,urlObject:new URL(J.url)};if(J.body)X.extractedBody=await J.json();for(let Q of G){let{handler:Z,inputSchema:x,outputSchema:z,params:$}=Q(X.url,X.method);if(!Z)continue;for(let U of p)await U(X);if($)X.params=$;return Z.constructor.name==="AsyncFunction"?await Z(X):Z(X)}throw new Error(`404|Not found: ${X.url}`)}function AJ(J){p.push(J)}function n({body:J,status:G=200}){if(G>=300&&G<400)return Response.redirect(J,G);let X=new Headers;if(X.set("status",G.toString()),J===void 0)return new Response("",{headers:X});return typeof J==="string"?new Response(`<pre>${J}</pre>`,{headers:{...X,"Content-Type":"text/html"}}):Response.json(J,{headers:{...X,"Content-Type":"application/json"}})}function WJ(J,G){let{message:X,stack:Q}=J,[Z,x,z]=X.split("|");return console.error({details:z,errCode:Z,msg:x,stack:Q}),n({body:G?x:{details:z,message:x,stack:Q},status:parseInt(Z)})}import i from"fs";import FJ from"path";function h(J,G){return i.readdirSync(J).forEach((Q)=>{let Z=FJ.join(J,Q);if(i.statSync(Z).isDirectory())G=h(Z,G);else G.push(Z)}),G}function s(J){try{return h(J,[])}catch(G){throw console.error("Error reading folder:",G),G}}function a(J){switch(J.split(".").pop()){case"html":return"text/html";case"css":return"text/css";case"js":return"application/javascript";case"json":return"application/json";case"jpg":return"image/jpeg";case"svg":return"image/svg+xml";default:return"text/plain"}}async function RJ(J,G){function X($){if($=$.slice(Q),$.endsWith(Z))$=$.replace(Z,"");return G+$}if(G===void 0)G=J;let Q=J.length,Z="index.html",x=s(J),z={};for(let $ of x)z[X($)]=new Response(await Bun.file($).bytes(),{headers:{"Content-Type":a($)}});return z}function TJ(J){let G=[];for(let X of J)G.push((Q,Z)=>{if(!(X.path instanceof RegExp?X.path.test(Q):X.path===Q))return!1;let{handler:z,inputSchema:$,outputSchema:j,paramsRegex:U}=X[Z];if(!z)throw new Error(`405|Method not allowed: ${Q}`);return{handler:z,inputSchema:$,outputSchema:j,params:U?0:void 0}});return G}import{stat as $G}from"fs";import{stat as zG,readdir as xG}from"fs/promises";import{EventEmitter as UG}from"events";import*as K from"path";import{stat as _J,lstat as r,readdir as gJ,realpath as PJ}from"fs/promises";import{Readable as SJ}from"stream";import{resolve as e,relative as uJ,join as vJ,sep as EJ}from"path";var Y={FILE_TYPE:"files",DIR_TYPE:"directories",FILE_DIR_TYPE:"files_directories",EVERYTHING_TYPE:"all"},S={root:".",fileFilter:(J)=>!0,directoryFilter:(J)=>!0,type:Y.FILE_TYPE,lstat:!1,depth:2147483648,alwaysStat:!1,highWaterMark:4096};Object.freeze(S);var XJ="READDIRP_RECURSIVE_ERROR",wJ=new Set(["ENOENT","EPERM","EACCES","ELOOP",XJ]),t=[Y.DIR_TYPE,Y.EVERYTHING_TYPE,Y.FILE_DIR_TYPE,Y.FILE_TYPE],fJ=new Set([Y.DIR_TYPE,Y.EVERYTHING_TYPE,Y.FILE_DIR_TYPE]),yJ=new Set([Y.EVERYTHING_TYPE,Y.FILE_DIR_TYPE,Y.FILE_TYPE]),mJ=(J)=>wJ.has(J.code),cJ=process.platform==="win32",JJ=(J)=>!0,GJ=(J)=>{if(J===void 0)return JJ;if(typeof J==="function")return J;if(typeof J==="string"){let G=J.trim();return(X)=>X.basename===G}if(Array.isArray(J)){let G=J.map((X)=>X.trim());return(X)=>G.some((Q)=>X.basename===Q)}return JJ};class QJ extends SJ{constructor(J={}){super({objectMode:!0,autoDestroy:!0,highWaterMark:J.highWaterMark});let G={...S,...J},{root:X,type:Q}=G;this._fileFilter=GJ(G.fileFilter),this._directoryFilter=GJ(G.directoryFilter);let Z=G.lstat?r:_J;if(cJ)this._stat=(x)=>Z(x,{bigint:!0});else this._stat=Z;this._maxDepth=G.depth??S.depth,this._wantsDir=Q?fJ.has(Q):!1,this._wantsFile=Q?yJ.has(Q):!1,this._wantsEverything=Q===Y.EVERYTHING_TYPE,this._root=e(X),this._isDirent=!G.alwaysStat,this._statsProp=this._isDirent?"dirent":"stats",this._rdOptions={encoding:"utf8",withFileTypes:this._isDirent},this.parents=[this._exploreDir(X,1)],this.reading=!1,this.parent=void 0}async _read(J){if(this.reading)return;this.reading=!0;try{while(!this.destroyed&&J>0){let G=this.parent,X=G&&G.files;if(X&&X.length>0){let{path:Q,depth:Z}=G,x=X.splice(0,J).map(($)=>this._formatEntry($,Q)),z=await Promise.all(x);for(let $ of z){if(!$)continue;if(this.destroyed)return;let j=await this._getEntryType($);if(j==="directory"&&this._directoryFilter($)){if(Z<=this._maxDepth)this.parents.push(this._exploreDir($.fullPath,Z+1));if(this._wantsDir)this.push($),J--}else if((j==="file"||this._includeAsFile($))&&this._fileFilter($)){if(this._wantsFile)this.push($),J--}}}else{let Q=this.parents.pop();if(!Q){this.push(null);break}if(this.parent=await Q,this.destroyed)return}}}catch(G){this.destroy(G)}finally{this.reading=!1}}async _exploreDir(J,G){let X;try{X=await gJ(J,this._rdOptions)}catch(Q){this._onError(Q)}return{files:X,depth:G,path:J}}async _formatEntry(J,G){let X,Q=this._isDirent?J.name:J;try{let Z=e(vJ(G,Q));X={path:uJ(this._root,Z),fullPath:Z,basename:Q},X[this._statsProp]=this._isDirent?J:await this._stat(Z)}catch(Z){this._onError(Z);return}return X}_onError(J){if(mJ(J)&&!this.destroyed)this.emit("warn",J);else this.destroy(J)}async _getEntryType(J){if(!J&&this._statsProp in J)return"";let G=J[this._statsProp];if(G.isFile())return"file";if(G.isDirectory())return"directory";if(G&&G.isSymbolicLink()){let X=J.fullPath;try{let Q=await PJ(X),Z=await r(Q);if(Z.isFile())return"file";if(Z.isDirectory()){let x=Q.length;if(X.startsWith(Q)&&X.substr(x,1)===EJ){let z=new Error(`Circular symlink detected: "${X}" points to "${Q}"`);return z.code=XJ,this._onError(z)}return"directory"}}catch(Q){return this._onError(Q),""}}}_includeAsFile(J){let G=J&&J[this._statsProp];return G&&this._wantsEverything&&!G.isDirectory()}}function ZJ(J,G={}){let X=G.entryType||G.type;if(X==="both")X=Y.FILE_DIR_TYPE;if(X)G.type=X;if(!J)throw new Error("readdirp: root argument is required. Usage: readdirp(root, options)");else if(typeof J!=="string")throw new TypeError("readdirp: root argument must be a string. Usage: readdirp(root, options)");else if(X&&!t.includes(X))throw new Error(`readdirp: Invalid type passed. Use one of ${t.join(", ")}`);return G.root=J,new QJ(G)}import{watchFile as dJ,unwatchFile as $J,watch as lJ}from"fs";import{open as pJ,stat as xJ,lstat as oJ,realpath as u}from"fs/promises";import*as k from"path";import{type as nJ}from"os";var iJ="data",w="end",UJ="close",T=()=>{};var _=process.platform,f=_==="win32",hJ=_==="darwin",sJ=_==="linux",aJ=_==="freebsd",jJ=nJ()==="OS400",N={ALL:"all",READY:"ready",ADD:"add",CHANGE:"change",ADD_DIR:"addDir",UNLINK:"unlink",UNLINK_DIR:"unlinkDir",RAW:"raw",ERROR:"error"},C=N,rJ="watch",eJ={lstat:oJ,stat:xJ},I="listeners",W="errHandlers",V="rawEmitters",tJ=[I,W,V],JG=new Set(["3dm","3ds","3g2","3gp","7z","a","aac","adp","afdesign","afphoto","afpub","ai","aif","aiff","alz","ape","apk","appimage","ar","arj","asf","au","avi","bak","baml","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","cur","dat","dcm","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","flatpak","fli","flv","fpx","fst","fvt","g3","gh","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lib","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","nupkg","o","odp","ods","odt","oga","ogg","ogv","otf","ott","pages","pbm","pcx","pdb","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","resources","rgb","rip","rlc","rmf","rmvb","rpm","rtf","rz","s3m","s7z","scpt","sgi","shar","snap","sil","sketch","slk","smv","snk","so","stl","suo","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wrm","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"]),GG=(J)=>JG.has(k.extname(J).slice(1).toLowerCase()),E=(J,G)=>{if(J instanceof Set)J.forEach(G);else G(J)},L=(J,G,X)=>{let Q=J[G];if(!(Q instanceof Set))J[G]=Q=new Set([Q]);Q.add(X)},XG=(J)=>(G)=>{let X=J[G];if(X instanceof Set)X.clear();else delete J[G]},b=(J,G,X)=>{let Q=J[G];if(Q instanceof Set)Q.delete(X);else if(Q===X)delete J[G]},BJ=(J)=>J instanceof Set?J.size===0:!J,F=new Map;function zJ(J,G,X,Q,Z){let x=(z,$)=>{if(X(J),Z(z,$,{watchedPath:J}),$&&J!==$)R(k.resolve(J,$),I,k.join(J,$))};try{return lJ(J,{persistent:G.persistent},x)}catch(z){Q(z);return}}var R=(J,G,X,Q,Z)=>{let x=F.get(J);if(!x)return;E(x[G],(z)=>{z(X,Q,Z)})},QG=(J,G,X,Q)=>{let{listener:Z,errHandler:x,rawEmitter:z}=Q,$=F.get(G),j;if(!X.persistent){if(j=zJ(J,X,Z,x,z),!j)return;return j.close.bind(j)}if($)L($,I,Z),L($,W,x),L($,V,z);else{if(j=zJ(J,X,R.bind(null,G,I),x,R.bind(null,G,V)),!j)return;j.on(C.ERROR,async(U)=>{let q=R.bind(null,G,W);if($)$.watcherUnusable=!0;if(f&&U.code==="EPERM")try{await(await pJ(J,"r")).close(),q(U)}catch(B){}else q(U)}),$={listeners:Z,errHandlers:x,rawEmitters:z,watcher:j},F.set(G,$)}return()=>{if(b($,I,Z),b($,W,x),b($,V,z),BJ($.listeners))$.watcher.close(),F.delete(G),tJ.forEach(XG($)),$.watcher=void 0,Object.freeze($)}},v=new Map,ZG=(J,G,X,Q)=>{let{listener:Z,rawEmitter:x}=Q,z=v.get(G),$=z&&z.options;if($&&($.persistent<X.persistent||$.interval>X.interval))$J(G),z=void 0;if(z)L(z,I,Z),L(z,V,x);else z={listeners:Z,rawEmitters:x,options:X,watcher:dJ(G,X,(j,U)=>{E(z.rawEmitters,(B)=>{B(C.CHANGE,G,{curr:j,prev:U})});let q=j.mtimeMs;if(j.size!==U.size||q>U.mtimeMs||q===0)E(z.listeners,(B)=>B(J,j))})},v.set(G,z);return()=>{if(b(z,I,Z),b(z,V,x),BJ(z.listeners))v.delete(G),$J(G),z.options=z.watcher=void 0,Object.freeze(z)}};class y{constructor(J){this.fsw=J,this._boundHandleError=(G)=>J._handleError(G)}_watchWithNodeFs(J,G){let X=this.fsw.options,Q=k.dirname(J),Z=k.basename(J);this.fsw._getWatchedDir(Q).add(Z);let z=k.resolve(J),$={persistent:X.persistent};if(!G)G=T;let j;if(X.usePolling){let U=X.interval!==X.binaryInterval;$.interval=U&&GG(Z)?X.binaryInterval:X.interval,j=ZG(J,z,$,{listener:G,rawEmitter:this.fsw._emitRaw})}else j=QG(J,z,$,{listener:G,errHandler:this._boundHandleError,rawEmitter:this.fsw._emitRaw});return j}_handleFile(J,G,X){if(this.fsw.closed)return;let Q=k.dirname(J),Z=k.basename(J),x=this.fsw._getWatchedDir(Q),z=G;if(x.has(Z))return;let $=async(U,q)=>{if(!this.fsw._throttle(rJ,J,5))return;if(!q||q.mtimeMs===0)try{let B=await xJ(J);if(this.fsw.closed)return;let{atimeMs:M,mtimeMs:H}=B;if(!M||M<=H||H!==z.mtimeMs)this.fsw._emit(C.CHANGE,J,B);if((hJ||sJ||aJ)&&z.ino!==B.ino){this.fsw._closeFile(U),z=B;let D=this._watchWithNodeFs(J,$);if(D)this.fsw._addPathCloser(U,D)}else z=B}catch(B){this.fsw._remove(Q,Z)}else if(x.has(Z)){let{atimeMs:B,mtimeMs:M}=q;if(!B||B<=M||M!==z.mtimeMs)this.fsw._emit(C.CHANGE,J,q);z=q}},j=this._watchWithNodeFs(J,$);if(!(X&&this.fsw.options.ignoreInitial)&&this.fsw._isntIgnored(J)){if(!this.fsw._throttle(C.ADD,J,0))return;this.fsw._emit(C.ADD,J,G)}return j}async _handleSymlink(J,G,X,Q){if(this.fsw.closed)return;let Z=J.fullPath,x=this.fsw._getWatchedDir(G);if(!this.fsw.options.followSymlinks){this.fsw._incrReadyCount();let z;try{z=await u(X)}catch($){return this.fsw._emitReady(),!0}if(this.fsw.closed)return;if(x.has(Q)){if(this.fsw._symlinkPaths.get(Z)!==z)this.fsw._symlinkPaths.set(Z,z),this.fsw._emit(C.CHANGE,X,J.stats)}else x.add(Q),this.fsw._symlinkPaths.set(Z,z),this.fsw._emit(C.ADD,X,J.stats);return this.fsw._emitReady(),!0}if(this.fsw._symlinkPaths.has(Z))return!0;this.fsw._symlinkPaths.set(Z,!0)}_handleRead(J,G,X,Q,Z,x,z){if(J=k.join(J,""),z=this.fsw._throttle("readdir",J,1000),!z)return;let $=this.fsw._getWatchedDir(X.path),j=new Set,U=this.fsw._readdirp(J,{fileFilter:(q)=>X.filterPath(q),directoryFilter:(q)=>X.filterDir(q)});if(!U)return;return U.on(iJ,async(q)=>{if(this.fsw.closed){U=void 0;return}let B=q.path,M=k.join(J,B);if(j.add(B),q.stats.isSymbolicLink()&&await this._handleSymlink(q,J,M,B))return;if(this.fsw.closed){U=void 0;return}if(B===Q||!Q&&!$.has(B))this.fsw._incrReadyCount(),M=k.join(Z,k.relative(Z,M)),this._addToNodeFs(M,G,X,x+1)}).on(C.ERROR,this._boundHandleError),new Promise((q,B)=>{if(!U)return B();U.once(w,()=>{if(this.fsw.closed){U=void 0;return}let M=z?z.clear():!1;if(q(void 0),$.getChildren().filter((H)=>{return H!==J&&!j.has(H)}).forEach((H)=>{this.fsw._remove(J,H)}),U=void 0,M)this._handleRead(J,!1,X,Q,Z,x,z)})})}async _handleDir(J,G,X,Q,Z,x,z){let $=this.fsw._getWatchedDir(k.dirname(J)),j=$.has(k.basename(J));if(!(X&&this.fsw.options.ignoreInitial)&&!Z&&!j)this.fsw._emit(C.ADD_DIR,J,G);$.add(k.basename(J)),this.fsw._getWatchedDir(J);let U,q,B=this.fsw.options.depth;if((B==null||Q<=B)&&!this.fsw._symlinkPaths.has(z)){if(!Z){if(await this._handleRead(J,X,x,Z,J,Q,U),this.fsw.closed)return}q=this._watchWithNodeFs(J,(M,H)=>{if(H&&H.mtimeMs===0)return;this._handleRead(M,!1,x,Z,J,Q,U)})}return q}async _addToNodeFs(J,G,X,Q,Z){let x=this.fsw._emitReady;if(this.fsw._isIgnored(J)||this.fsw.closed)return x(),!1;let z=this.fsw._getWatchHelpers(J);if(X)z.filterPath=($)=>X.filterPath($),z.filterDir=($)=>X.filterDir($);try{let $=await eJ[z.statMethod](z.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(z.watchPath,$))return x(),!1;let j=this.fsw.options.followSymlinks,U;if($.isDirectory()){let q=k.resolve(J),B=j?await u(J):J;if(this.fsw.closed)return;if(U=await this._handleDir(z.watchPath,$,G,Q,Z,z,B),this.fsw.closed)return;if(q!==B&&B!==void 0)this.fsw._symlinkPaths.set(q,B)}else if($.isSymbolicLink()){let q=j?await u(J):J;if(this.fsw.closed)return;let B=k.dirname(z.watchPath);if(this.fsw._getWatchedDir(B).add(z.watchPath),this.fsw._emit(C.ADD,z.watchPath,$),U=await this._handleDir(B,$,G,Q,J,z,q),this.fsw.closed)return;if(q!==void 0)this.fsw._symlinkPaths.set(k.resolve(J),q)}else U=this._handleFile(z.watchPath,$,G);if(x(),U)this.fsw._addPathCloser(J,U);return!1}catch($){if(this.fsw._handleError($))return x(),J}}}/*! chokidar - MIT License (c) 2012 Paul Miller (paulmillr.com) */var m="/",jG="//",HJ=".",BG="..",qG="string",KG=/\\/g,qJ=/\/\//,NG=/\..*\.(sw[px])$|~$|\.subl.*\.tmp/,kG=/^\.[/\\]/;function g(J){return Array.isArray(J)?J:[J]}var c=(J)=>typeof J==="object"&&J!==null&&!(J instanceof RegExp);function MG(J){if(typeof J==="function")return J;if(typeof J==="string")return(G)=>J===G;if(J instanceof RegExp)return(G)=>J.test(G);if(typeof J==="object"&&J!==null)return(G)=>{if(J.path===G)return!0;if(J.recursive){let X=K.relative(J.path,G);if(!X)return!1;return!X.startsWith("..")&&!K.isAbsolute(X)}return!1};return()=>!1}function HG(J){if(typeof J!=="string")throw new Error("string expected");J=K.normalize(J),J=J.replace(/\\/g,"/");let G=!1;if(J.startsWith("//"))G=!0;let X=/\/\//;while(J.match(X))J=J.replace(X,"/");if(G)J="/"+J;return J}function KJ(J,G,X){let Q=HG(G);for(let Z=0;Z<J.length;Z++){let x=J[Z];if(x(Q,X))return!0}return!1}function YG(J,G){if(J==null)throw new TypeError("anymatch: specify first argument");let Q=g(J).map((Z)=>MG(Z));if(G==null)return(Z,x)=>{return KJ(Q,Z,x)};return KJ(Q,G)}var NJ=(J)=>{let G=g(J).flat();if(!G.every((X)=>typeof X===qG))throw new TypeError(`Non-string provided as watch path: ${G}`);return G.map(YJ)},kJ=(J)=>{let G=J.replace(KG,m),X=!1;if(G.startsWith(jG))X=!0;while(G.match(qJ))G=G.replace(qJ,m);if(X)G=m+G;return G},YJ=(J)=>kJ(K.normalize(kJ(J))),MJ=(J="")=>(G)=>{if(typeof G==="string")return YJ(K.isAbsolute(G)?G:K.join(J,G));else return G},CG=(J,G)=>{if(K.isAbsolute(J))return J;return K.join(G,J)},IG=Object.freeze(new Set);class CJ{constructor(J,G){this.path=J,this._removeWatcher=G,this.items=new Set}add(J){let{items:G}=this;if(!G)return;if(J!==HJ&&J!==BG)G.add(J)}async remove(J){let{items:G}=this;if(!G)return;if(G.delete(J),G.size>0)return;let X=this.path;try{await xG(X)}catch(Q){if(this._removeWatcher)this._removeWatcher(K.dirname(X),K.basename(X))}}has(J){let{items:G}=this;if(!G)return;return G.has(J)}getChildren(){let{items:J}=this;if(!J)return[];return[...J.values()]}dispose(){this.items.clear(),this.path="",this._removeWatcher=T,this.items=IG,Object.freeze(this)}}var VG="stat",DG="lstat";class IJ{constructor(J,G,X){this.fsw=X;let Q=J;this.path=J=J.replace(kG,""),this.watchPath=Q,this.fullWatchPath=K.resolve(Q),this.dirParts=[],this.dirParts.forEach((Z)=>{if(Z.length>1)Z.pop()}),this.followSymlinks=G,this.statMethod=G?VG:DG}entryPath(J){return K.join(this.watchPath,K.relative(this.watchPath,J.fullPath))}filterPath(J){let{stats:G}=J;if(G&&G.isSymbolicLink())return this.filterDir(J);let X=this.entryPath(J);return this.fsw._isntIgnored(X,G)&&this.fsw._hasReadPermissions(G)}filterDir(J){return this.fsw._isntIgnored(this.entryPath(J),J.stats)}}class VJ extends UG{constructor(J={}){super();this.closed=!1,this._closers=new Map,this._ignoredPaths=new Set,this._throttled=new Map,this._streams=new Set,this._symlinkPaths=new Map,this._watched=new Map,this._pendingWrites=new Map,this._pendingUnlinks=new Map,this._readyCount=0,this._readyEmitted=!1;let G=J.awaitWriteFinish,X={stabilityThreshold:2000,pollInterval:100},Q={persistent:!0,ignoreInitial:!1,ignorePermissionErrors:!1,interval:100,binaryInterval:300,followSymlinks:!0,usePolling:!1,atomic:!0,...J,ignored:J.ignored?g(J.ignored):g([]),awaitWriteFinish:G===!0?X:typeof G==="object"?{...X,...G}:!1};if(jJ)Q.usePolling=!0;if(Q.atomic===void 0)Q.atomic=!Q.usePolling;let Z=process.env.CHOKIDAR_USEPOLLING;if(Z!==void 0){let $=Z.toLowerCase();if($==="false"||$==="0")Q.usePolling=!1;else if($==="true"||$==="1")Q.usePolling=!0;else Q.usePolling=!!$}let x=process.env.CHOKIDAR_INTERVAL;if(x)Q.interval=Number.parseInt(x,10);let z=0;this._emitReady=()=>{if(z++,z>=this._readyCount)this._emitReady=T,this._readyEmitted=!0,process.nextTick(()=>this.emit(N.READY))},this._emitRaw=(...$)=>this.emit(N.RAW,...$),this._boundRemove=this._remove.bind(this),this.options=Q,this._nodeFsHandler=new y(this),Object.freeze(Q)}_addIgnoredPath(J){if(c(J)){for(let G of this._ignoredPaths)if(c(G)&&G.path===J.path&&G.recursive===J.recursive)return}this._ignoredPaths.add(J)}_removeIgnoredPath(J){if(this._ignoredPaths.delete(J),typeof J==="string"){for(let G of this._ignoredPaths)if(c(G)&&G.path===J)this._ignoredPaths.delete(G)}}add(J,G,X){let{cwd:Q}=this.options;this.closed=!1,this._closePromise=void 0;let Z=NJ(J);if(Q)Z=Z.map((x)=>{return CG(x,Q)});if(Z.forEach((x)=>{this._removeIgnoredPath(x)}),this._userIgnored=void 0,!this._readyCount)this._readyCount=0;return this._readyCount+=Z.length,Promise.all(Z.map(async(x)=>{let z=await this._nodeFsHandler._addToNodeFs(x,!X,void 0,0,G);if(z)this._emitReady();return z})).then((x)=>{if(this.closed)return;x.forEach((z)=>{if(z)this.add(K.dirname(z),K.basename(G||z))})}),this}unwatch(J){if(this.closed)return this;let G=NJ(J),{cwd:X}=this.options;return G.forEach((Q)=>{if(!K.isAbsolute(Q)&&!this._closers.has(Q)){if(X)Q=K.join(X,Q);Q=K.resolve(Q)}if(this._closePath(Q),this._addIgnoredPath(Q),this._watched.has(Q))this._addIgnoredPath({path:Q,recursive:!0});this._userIgnored=void 0}),this}close(){if(this._closePromise)return this._closePromise;this.closed=!0,this.removeAllListeners();let J=[];return this._closers.forEach((G)=>G.forEach((X)=>{let Q=X();if(Q instanceof Promise)J.push(Q)})),this._streams.forEach((G)=>G.destroy()),this._userIgnored=void 0,this._readyCount=0,this._readyEmitted=!1,this._watched.forEach((G)=>G.dispose()),this._closers.clear(),this._watched.clear(),this._streams.clear(),this._symlinkPaths.clear(),this._throttled.clear(),this._closePromise=J.length?Promise.all(J).then(()=>{return}):Promise.resolve(),this._closePromise}getWatched(){let J={};return this._watched.forEach((G,X)=>{let Z=(this.options.cwd?K.relative(this.options.cwd,X):X)||HJ;J[Z]=G.getChildren().sort()}),J}emitWithAll(J,G){if(this.emit(J,...G),J!==N.ERROR)this.emit(N.ALL,J,...G)}async _emit(J,G,X){if(this.closed)return;let Q=this.options;if(f)G=K.normalize(G);if(Q.cwd)G=K.relative(Q.cwd,G);let Z=[G];if(X!=null)Z.push(X);let x=Q.awaitWriteFinish,z;if(x&&(z=this._pendingWrites.get(G)))return z.lastChange=new Date,this;if(Q.atomic){if(J===N.UNLINK)return this._pendingUnlinks.set(G,[J,...Z]),setTimeout(()=>{this._pendingUnlinks.forEach(($,j)=>{this.emit(...$),this.emit(N.ALL,...$),this._pendingUnlinks.delete(j)})},typeof Q.atomic==="number"?Q.atomic:100),this;if(J===N.ADD&&this._pendingUnlinks.has(G))J=N.CHANGE,this._pendingUnlinks.delete(G)}if(x&&(J===N.ADD||J===N.CHANGE)&&this._readyEmitted){let $=(j,U)=>{if(j)J=N.ERROR,Z[0]=j,this.emitWithAll(J,Z);else if(U){if(Z.length>1)Z[1]=U;else Z.push(U);this.emitWithAll(J,Z)}};return this._awaitWriteFinish(G,x.stabilityThreshold,J,$),this}if(J===N.CHANGE){if(!this._throttle(N.CHANGE,G,50))return this}if(Q.alwaysStat&&X===void 0&&(J===N.ADD||J===N.ADD_DIR||J===N.CHANGE)){let $=Q.cwd?K.join(Q.cwd,G):G,j;try{j=await zG($)}catch(U){}if(!j||this.closed)return;Z.push(j)}return this.emitWithAll(J,Z),this}_handleError(J){let G=J&&J.code;if(J&&G!=="ENOENT"&&G!=="ENOTDIR"&&(!this.options.ignorePermissionErrors||G!=="EPERM"&&G!=="EACCES"))this.emit(N.ERROR,J);return J||this.closed}_throttle(J,G,X){if(!this._throttled.has(J))this._throttled.set(J,new Map);let Q=this._throttled.get(J);if(!Q)throw new Error("invalid throttle");let Z=Q.get(G);if(Z)return Z.count++,!1;let x,z=()=>{let j=Q.get(G),U=j?j.count:0;if(Q.delete(G),clearTimeout(x),j)clearTimeout(j.timeoutObject);return U};x=setTimeout(z,X);let $={timeoutObject:x,clear:z,count:0};return Q.set(G,$),$}_incrReadyCount(){return this._readyCount++}_awaitWriteFinish(J,G,X,Q){let Z=this.options.awaitWriteFinish;if(typeof Z!=="object")return;let x=Z.pollInterval,z,$=J;if(this.options.cwd&&!K.isAbsolute(J))$=K.join(this.options.cwd,J);let j=new Date,U=this._pendingWrites;function q(B){$G($,(M,H)=>{if(M||!U.has(J)){if(M&&M.code!=="ENOENT")Q(M);return}let D=Number(new Date);if(B&&H.size!==B.size)U.get(J).lastChange=D;let OJ=U.get(J);if(D-OJ.lastChange>=G)U.delete(J),Q(void 0,H);else z=setTimeout(q,x,H)})}if(!U.has(J))U.set(J,{lastChange:j,cancelWait:()=>{return U.delete(J),clearTimeout(z),X}}),z=setTimeout(q,x)}_isIgnored(J,G){if(this.options.atomic&&NG.test(J))return!0;if(!this._userIgnored){let{cwd:X}=this.options,Z=(this.options.ignored||[]).map(MJ(X)),z=[...[...this._ignoredPaths].map(MJ(X)),...Z];this._userIgnored=YG(z,void 0)}return this._userIgnored(J,G)}_isntIgnored(J,G){return!this._isIgnored(J,G)}_getWatchHelpers(J){return new IJ(J,this.options.followSymlinks,this)}_getWatchedDir(J){let G=K.resolve(J);if(!this._watched.has(G))this._watched.set(G,new CJ(G,this._boundRemove));return this._watched.get(G)}_hasReadPermissions(J){if(this.options.ignorePermissionErrors)return!0;return Boolean(Number(J.mode)&256)}_remove(J,G,X){let Q=K.join(J,G),Z=K.resolve(Q);if(X=X!=null?X:this._watched.has(Q)||this._watched.has(Z),!this._throttle("remove",Q,100))return;if(!X&&this._watched.size===1)this.add(J,G,!0);this._getWatchedDir(Q).getChildren().forEach((B)=>this._remove(Q,B));let $=this._getWatchedDir(J),j=$.has(G);if($.remove(G),this._symlinkPaths.has(Z))this._symlinkPaths.delete(Z);let U=Q;if(this.options.cwd)U=K.relative(this.options.cwd,Q);if(this.options.awaitWriteFinish&&this._pendingWrites.has(U)){if(this._pendingWrites.get(U).cancelWait()===N.ADD)return}this._watched.delete(Q),this._watched.delete(Z);let q=X?N.UNLINK_DIR:N.UNLINK;if(j&&!this._isIgnored(Q))this._emit(q,Q);this._closePath(Q)}_closePath(J){this._closeFile(J);let G=K.dirname(J);this._getWatchedDir(G).remove(K.basename(J))}_closeFile(J){let G=this._closers.get(J);if(!G)return;G.forEach((X)=>X()),this._closers.delete(J)}_addPathCloser(J,G){if(!G)return;let X=this._closers.get(J);if(!X)X=[],this._closers.set(J,X);X.push(G)}_readdirp(J,G){if(this.closed)return;let X={type:N.ALL,alwaysStat:!0,lstat:!0,...G,depth:0},Q=ZJ(J,X);return this._streams.add(Q),Q.once(UJ,()=>{Q=void 0}),Q.once(w,()=>{if(Q)this._streams.delete(Q),Q=void 0}),Q}}function DJ(J,G={}){let X=new VJ(G);return X.add(J),X}function OG(J,G){let X=DJ(J,{persistent:!0}),Q=async(Z)=>{P(G(Z))};X.on("change",(Z)=>{Q(Z)})}export{OG as useWatcher,LJ as useServer,AJ as useMiddleware,bJ as useDynamicRoutes,WJ as useDefaultErrorHandler,P as reloadServer,RJ as addStaticFolder,TJ as addRoutes,d as Method,A as ContentType};
